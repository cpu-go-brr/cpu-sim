#include "Intel4004.hpp"
#include <iostream>
int main(int argc, char **argv)
{
    Intel4004 cpu;
    // [[maybe_unused]] auto A = bitset(0b0001, 4);
    // [[maybe_unused]] auto B = bitset(0b0011, 8); 

    // bitset a{0b101,3};   
    // char buffer[2] = {};
    // AddressInfo info;
    // info.bit_offset = 6;
    // info.byte_start = 0;
    // info.length = 3;
    // a.write((uint8_t*)&buffer[0],info);

    // std::cout <<(int) ((unsigned char)buffer[0])  << "\n";
    // std::cout <<(unsigned int)buffer[1]  << "\n";

    // auto res = get_mem((uint8_t*)&buffer[0], info);

    // cpu.flash_rom({0b11010001});
    // std::cout << (cpu.rom(cpu.get(PC)+1)).bin() << "\n";
    // std::cout << (A,cpu.rom(cpu.get(PC)+1)).bin() << "\n";
    
    cpu.flash_rom({0x28, 0x00, 0x29, 0xEA, 0xB0, 0x68, 0x29, 0xEA, 0xB1, 0x50, 0x68, 0xB2, 0xE1, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xB2, 0xD4, 0xB0, 0xF6, 0xB0, 0x1A, 0x7A, 0xB1, 0xF6, 0xB1, 0xB2, 0xF6, 0xB2, 0xF8, 0x1C, 0x6B, 0xC0, 0xB1, 0xF6, 0xB1, 0xF1, 0x40, 0x73});

    for (int i = 100; i --> 0;)
    {
        // cpu.display();
        // std::getchar();
        cpu.simulate(1);
        std::cout << cpu.get(ACC).bin() << "\n";
    }

    return 0;
}